import{_ as q,u as z,j as B,a as I,r as g,k as b,b as i,c as N,d as S,e as a,h as o,w as r,l as x,i as m,v as A,E as p,m as D}from"./main-ca0a91d8.js";const $={class:"login-page"},h={class:"login-container"},j={class:"login-card"},T={class:"login-links"},G={__name:"Login",setup(H){const P=z(),E=B(),F=I(),_=g(),c=g(),v=g(!1),d=g(!1),w=g(!1),n=b({identifier:"",password:""}),u=b({email:""}),R={identifier:[{required:!0,message:"请输入用户ID或邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}]},C={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{validator:(f,e,l)=>{e&&!A(e)?l(new Error("请输入有效的邮箱地址")):l()},trigger:"blur"}]},V=async()=>{_.value&&await _.value.validate(async f=>{var e,l;if(f){v.value=!0;try{await F.loginUser(n),p.success("登录成功");const s=E.query.redirect||"/";P.push(s)}catch(s){p.error(((l=(e=s.response)==null?void 0:e.data)==null?void 0:l.message)||"登录失败")}finally{v.value=!1}}})},L=async()=>{c.value&&await c.value.validate(async f=>{var e,l;if(f){w.value=!0;try{await D(u.email),p.success("重置密码邮件已发送，请检查您的邮箱"),d.value=!1,u.email=""}catch(s){p.error(((l=(e=s.response)==null?void 0:e.data)==null?void 0:l.message)||"发送失败")}finally{w.value=!1}}})};return(f,e)=>{const l=i("el-input"),s=i("el-form-item"),y=i("el-button"),k=i("el-form"),U=i("router-link"),M=i("el-dialog");return N(),S("div",$,[a("div",h,[a("div",j,[e[8]||(e[8]=a("div",{class:"login-header"},[a("h1",null,"登录 MiragEdge"),a("p",null,"欢迎回来，请登录您的账户")],-1)),o(k,{ref_key:"loginFormRef",ref:_,model:n,rules:R,class:"login-form",onSubmit:x(V,["prevent"])},{default:r(()=>[o(s,{prop:"identifier"},{default:r(()=>[o(l,{modelValue:n.identifier,"onUpdate:modelValue":e[0]||(e[0]=t=>n.identifier=t),placeholder:"用户ID或邮箱",size:"large","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(s,{prop:"password"},{default:r(()=>[o(l,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),type:"password",placeholder:"密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(s,null,{default:r(()=>[o(y,{type:"primary",size:"large",loading:v.value,onClick:V,class:"login-button"},{default:r(()=>[...e[6]||(e[6]=[m(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",T,[o(U,{to:"/register",class:"link"},{default:r(()=>[...e[7]||(e[7]=[m("注册新账户",-1)])]),_:1}),a("a",{href:"#",class:"link",onClick:e[2]||(e[2]=x(t=>d.value=!0,["prevent"]))},"忘记密码？")])]),e[9]||(e[9]=a("div",{class:"login-footer"},[a("p",null,"© 2024 MiragEdge. All rights reserved.")],-1))]),o(M,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value=t),title:"重置密码",width:"400px"},{footer:r(()=>[o(y,{onClick:e[4]||(e[4]=t=>d.value=!1)},{default:r(()=>[...e[10]||(e[10]=[m("取消",-1)])]),_:1}),o(y,{type:"primary",loading:w.value,onClick:L},{default:r(()=>[...e[11]||(e[11]=[m(" 发送重置邮件 ",-1)])]),_:1},8,["loading"])]),default:r(()=>[o(k,{ref_key:"forgotPasswordFormRef",ref:c,model:u,rules:C},{default:r(()=>[o(s,{prop:"email"},{default:r(()=>[o(l,{modelValue:u.email,"onUpdate:modelValue":e[3]||(e[3]=t=>u.email=t),placeholder:"请输入注册邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},K=q(G,[["__scopeId","data-v-fabb3742"]]);export{K as default};
