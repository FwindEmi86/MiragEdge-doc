import{M as T,N as F,O as G,r as U,_ as H,a as J,k as N,b as s,c as B,d as C,f as _,h as t,w as n,e as a,i as u,t as R,P as K,Q as W,A as X,E as g,R as Y}from"./main-ca0a91d8.js";const Z=d=>{const o=new FormData;return o.append("file",d),T.post(F.USER.UPDATE_AVATAR,o,{headers:{"Content-Type":"multipart/form-data"}})},h=d=>T.post(F.USER.BIND_MINECRAFT,d),ee=G("user",()=>{const d=U(!1);return{loading:d,updateUserProfile:async f=>http.put("/api/users/usermanage/profile",userData).then(r=>r.data&&r.data.success!==void 0?r.data:{success:!0,message:"更新成功",data:r.data}),uploadAvatar:async f=>{d.value=!0;try{return await Z(f)}finally{d.value=!1}},bindMinecraftAccount:async f=>{d.value=!0;try{return await h(f)}finally{d.value=!1}}}});const te={class:"minecraft-binding"},ne={key:0,class:"binding-status bound"},ae={class:"minecraft-info"},le={key:1,class:"binding-status unbound"},re={class:"binding-benefits"},ie={class:"benefit-item"},oe={class:"benefit-item"},se={class:"benefit-item"},ue={__name:"MinecraftBinding",setup(d){const o=J(),D=ee(),b=U(!1),f=U(!1),r=U(!1),w=U(!1),I=U(),V=U(),c=N({minecraftUsername:"",minecraftUuid:""}),p=N({minecraftUsername:"",minecraftUuid:""}),S={minecraftUsername:[{required:!0,message:"请输入 Minecraft 游戏ID",trigger:"blur"},{min:3,max:16,message:"游戏ID长度应在3-16个字符之间",trigger:"blur"}],minecraftUuid:[{required:!0,message:"请输入 UUID",trigger:"blur"},{pattern:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,message:"请输入有效的 UUID 格式",trigger:"blur"}]},$=m=>m?new Date(m).toLocaleString("zh-CN"):"未知",O=async()=>{I.value&&await I.value.validate(async m=>{var e,i;if(m){r.value=!0;try{await D.bindMinecraftAccount(c),await o.fetchUserProfile(),g.success("Minecraft 账户绑定成功"),b.value=!1,c.minecraftUsername="",c.minecraftUuid=""}catch(v){g.error(((i=(e=v.response)==null?void 0:e.data)==null?void 0:i.message)||"绑定失败")}finally{r.value=!1}}})},j=async()=>{V.value&&await V.value.validate(async m=>{var e,i;if(m){r.value=!0;try{await D.bindMinecraftAccount(p),await o.fetchUserProfile(),g.success("Minecraft 账户重新绑定成功"),f.value=!1,p.minecraftUsername="",p.minecraftUuid=""}catch(v){g.error(((i=(e=v.response)==null?void 0:e.data)==null?void 0:i.message)||"重新绑定失败")}finally{r.value=!1}}})},q=async()=>{try{await Y.confirm("确定要解绑 Minecraft 账户吗？解绑后您将失去服务器白名单权限。","确认解绑",{confirmButtonText:"确定解绑",cancelButtonText:"取消",type:"warning"}),w.value=!0;try{await o.fetchUserProfile(),g.success("Minecraft 账户已解绑")}catch{g.error("解绑失败")}finally{w.value=!1}}catch{}};return(m,e)=>{const i=s("el-button"),v=s("el-result"),x=s("el-descriptions-item"),z=s("el-descriptions"),A=s("el-icon"),k=s("el-col"),L=s("el-row"),y=s("el-input"),M=s("el-form-item"),P=s("el-form"),E=s("el-dialog"),Q=s("el-alert");return B(),C("div",te,[_(o).user.minecraftUuid?(B(),C("div",ne,[t(v,{icon:"success",title:"Minecraft 账户已绑定","sub-title":`已绑定账户: ${_(o).user.minecraftUsername}`},{extra:n(()=>[t(i,{type:"primary",onClick:e[0]||(e[0]=l=>f.value=!0)},{default:n(()=>[...e[10]||(e[10]=[u(" 重新绑定 ",-1)])]),_:1}),t(i,{onClick:q,loading:w.value},{default:n(()=>[...e[11]||(e[11]=[u(" 解绑账户 ",-1)])]),_:1},8,["loading"])]),_:1},8,["sub-title"]),a("div",ae,[e[12]||(e[12]=a("h3",null,"账户信息",-1)),t(z,{column:1,border:""},{default:n(()=>[t(x,{label:"游戏ID"},{default:n(()=>[u(R(_(o).user.minecraftUsername),1)]),_:1}),t(x,{label:"UUID"},{default:n(()=>[u(R(_(o).user.minecraftUuid),1)]),_:1}),t(x,{label:"绑定时间"},{default:n(()=>[u(R($(_(o).user.updatedAt)),1)]),_:1})]),_:1})])])):(B(),C("div",le,[t(v,{icon:"warning",title:"Minecraft 账户未绑定","sub-title":"绑定 Minecraft 账户以启用服务器白名单功能"},{extra:n(()=>[t(i,{type:"primary",onClick:e[1]||(e[1]=l=>b.value=!0)},{default:n(()=>[...e[13]||(e[13]=[u(" 立即绑定 ",-1)])]),_:1})]),_:1}),a("div",re,[e[20]||(e[20]=a("h3",null,"绑定账户的好处",-1)),t(L,{gutter:20},{default:n(()=>[t(k,{xs:24,sm:12,md:8},{default:n(()=>[a("div",ie,[t(A,null,{default:n(()=>[t(_(K))]),_:1}),e[14]||(e[14]=a("h4",null,"白名单权限",-1)),e[15]||(e[15]=a("p",null,"获得服务器白名单，畅玩游戏",-1))])]),_:1}),t(k,{xs:24,sm:12,md:8},{default:n(()=>[a("div",oe,[t(A,null,{default:n(()=>[t(_(W))]),_:1}),e[16]||(e[16]=a("h4",null,"数据同步",-1)),e[17]||(e[17]=a("p",null,"游戏数据与网站账户同步",-1))])]),_:1}),t(k,{xs:24,sm:12,md:8},{default:n(()=>[a("div",se,[t(A,null,{default:n(()=>[t(_(X))]),_:1}),e[18]||(e[18]=a("h4",null,"社区特权",-1)),e[19]||(e[19]=a("p",null,"解锁论坛专属版块和功能",-1))])]),_:1})]),_:1})])])),t(E,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),title:"绑定 Minecraft 账户",width:"500px"},{footer:n(()=>[t(i,{onClick:e[4]||(e[4]=l=>b.value=!1)},{default:n(()=>[...e[22]||(e[22]=[u("取消",-1)])]),_:1}),t(i,{type:"primary",loading:r.value,onClick:O},{default:n(()=>[...e[23]||(e[23]=[u(" 确认绑定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(P,{ref_key:"bindFormRef",ref:I,model:c,rules:S,"label-width":"120px"},{default:n(()=>[t(M,{label:"Minecraft 游戏ID",prop:"minecraftUsername"},{default:n(()=>[t(y,{modelValue:c.minecraftUsername,"onUpdate:modelValue":e[2]||(e[2]=l=>c.minecraftUsername=l),placeholder:"请输入您的 Minecraft 游戏ID"},null,8,["modelValue"])]),_:1}),t(M,{label:"UUID",prop:"minecraftUuid"},{default:n(()=>[t(y,{modelValue:c.minecraftUuid,"onUpdate:modelValue":e[3]||(e[3]=l=>c.minecraftUuid=l),placeholder:"请输入 Minecraft UUID"},null,8,["modelValue"]),e[21]||(e[21]=a("div",{class:"uuid-help"},[a("p",null,"如何获取 UUID？"),a("ul",null,[a("li",null,[u("访问 "),a("a",{href:"https://mcuuid.net",target:"_blank"},"mcuuid.net")]),a("li",null,"输入您的游戏ID查询"),a("li",null,"复制 UUID 字段")])],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(E,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=l=>f.value=l),title:"重新绑定 Minecraft 账户",width:"500px"},{footer:n(()=>[t(i,{onClick:e[8]||(e[8]=l=>f.value=!1)},{default:n(()=>[...e[24]||(e[24]=[u("取消",-1)])]),_:1}),t(i,{type:"primary",loading:r.value,onClick:j},{default:n(()=>[...e[25]||(e[25]=[u(" 确认重新绑定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(Q,{title:"注意",type:"warning",description:"重新绑定将会替换当前已绑定的账户，原有账户的游戏数据将无法同步。","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),t(P,{ref_key:"rebindFormRef",ref:V,model:p,rules:S,"label-width":"120px"},{default:n(()=>[t(M,{label:"新的游戏ID",prop:"minecraftUsername"},{default:n(()=>[t(y,{modelValue:p.minecraftUsername,"onUpdate:modelValue":e[6]||(e[6]=l=>p.minecraftUsername=l),placeholder:"请输入新的 Minecraft 游戏ID"},null,8,["modelValue"])]),_:1}),t(M,{label:"新的 UUID",prop:"minecraftUuid"},{default:n(()=>[t(y,{modelValue:p.minecraftUuid,"onUpdate:modelValue":e[7]||(e[7]=l=>p.minecraftUuid=l),placeholder:"请输入新的 Minecraft UUID"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},de=H(ue,[["__scopeId","data-v-09c3f5f3"]]),me=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{de as M,me as a,ee as u};
