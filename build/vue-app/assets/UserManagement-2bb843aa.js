import{_ as D,a as z,s as Q,b as n,c as _,d as k,h as a,w as l,e as t,g as G,f as w,C as X,D as Y,i as g,G as J,H as Z,I as j,E as q,r as I,k as T,o as h,J as ee,K as ae,L as le,B as te,p as se,v as re,q as oe}from"./main-ca0a91d8.js";import{u as H,M as ne}from"./MinecraftBinding-ab544597.js";const de={class:"avatar-upload"},ue={key:0,class:"upload-loading"},ie={__name:"AvatarUpload",props:{modelValue:String},emits:["update:modelValue","uploaded"],setup(L,{emit:f}){const F=L,y=f,b=H(),M=z(),A=Q(()=>b.loading),E=Q(()=>{var d;const v=F.modelValue||((d=M.user)==null?void 0:d.avatarUrl);return v?`/api/files/avatars/${v}`:""}),s=v=>{const d=Z.includes(v.type),V=v.size<j;return d?V?!0:(q.error("图片大小不能超过 10MB!"),!1):(q.error("只能上传图片文件!"),!1)},u=async v=>{var d,V,P;try{const U=await b.uploadAvatar(v.file),B=((d=U.data)==null?void 0:d.avatarUrl)||U.avatarUrl;y("update:modelValue",B),y("uploaded",B),await M.fetchUserProfile(),q.success("头像上传成功")}catch(U){q.error("头像上传失败: "+(((P=(V=U.response)==null?void 0:V.data)==null?void 0:P.message)||U.message))}};return(v,d)=>{const V=n("el-avatar"),P=n("el-icon"),U=n("el-upload");return _(),k("div",de,[a(U,{class:"avatar-uploader",action:"#","show-file-list":!1,"before-upload":s,"http-request":u,disabled:A.value},{tip:l(()=>[...d[0]||(d[0]=[t("div",{class:"el-upload__tip"}," 支持 JPG、PNG、GIF 格式，大小不超过 10MB ",-1)])]),default:l(()=>[E.value?(_(),G(V,{key:0,size:120,src:E.value},null,8,["src"])):(_(),G(P,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[a(w(X))]),_:1}))]),_:1},8,["disabled"]),A.value?(_(),k("div",ue,[a(P,{class:"is-loading"},{default:l(()=>[a(w(Y))]),_:1}),d[1]||(d[1]=g(" 上传中... ",-1))])):J("",!0)])}}},me=D(ie,[["__scopeId","data-v-84b0376c"]]);const pe={class:"user-management"},fe={class:"container"},_e={class:"management-content"},ve={key:0,class:"tab-content"},ce={key:1,class:"tab-content"},ge={key:2,class:"tab-content"},we={class:"security-items"},ye={class:"security-item"},Ue={class:"security-item"},be={class:"security-item"},Ve={key:3,class:"tab-content"},Pe={__name:"UserManagement",setup(L){const f=z(),F=H(),y=I("profile"),b=I(!1),M=I(!1),A=I(),E=I(),s=T({username:"",email:"",qqNumber:"",avatarUrl:""}),u=T({currentPassword:"",newPassword:"",confirmPassword:""}),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:(i,e,r)=>{e&&!se(e)?r(new Error("用户名长度应在2-100个字符之间")):r()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{validator:(i,e,r)=>{e&&!re(e)?r(new Error("请输入有效的邮箱地址")):r()},trigger:"blur"}]},d={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{validator:(i,e,r)=>{e&&!oe(e)?r(new Error("密码长度至少6位")):r()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(i,e,r)=>{e!==u.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]};h(()=>{P()});const V=i=>{y.value=i},P=()=>{f.user&&(s.username=f.user.username,s.email=f.user.email,s.qqNumber=f.user.qqNumber||"",s.avatarUrl=f.user.avatarUrl||"")},U=async()=>{A.value&&await A.value.validate(async i=>{var e,r,x,R,N,S,c,m,C;if(i)try{await F.updateUserProfile({username:s.username,email:s.email,qqNumber:s.qqNumber,avatarUrl:s.avatarUrl}),await f.fetchUserProfile(),q.success("个人信息更新成功")}catch(p){const $=((r=(e=p.response)==null?void 0:e.data)==null?void 0:r.message)||((N=(R=(x=p.response)==null?void 0:x.data)==null?void 0:R.data)==null?void 0:N.username)||((m=(c=(S=p.response)==null?void 0:S.data)==null?void 0:c.data)==null?void 0:m.email)||"更新失败，请检查输入信息";q.error($),console.error("Update profile error:",(C=p.response)==null?void 0:C.data)}})},B=i=>{s.avatarUrl=i},K=async()=>{E.value&&await E.value.validate(async i=>{if(i){M.value=!0;try{q.success("密码修改成功"),b.value=!1,u.currentPassword="",u.newPassword="",u.confirmPassword=""}catch{q.error("密码修改失败")}finally{M.value=!1}}})};return(i,e)=>{const r=n("el-icon"),x=n("el-menu-item"),R=n("el-menu"),N=n("el-card"),S=n("el-col"),c=n("el-input"),m=n("el-form-item"),C=n("el-tag"),p=n("el-button"),$=n("el-form"),O=n("el-row"),W=n("el-dialog");return _(),k("div",pe,[t("div",fe,[e[29]||(e[29]=t("div",{class:"management-header"},[t("h1",null,"账户管理"),t("p",null,"管理您的个人信息和账户设置")],-1)),t("div",_e,[a(O,{gutter:20},{default:l(()=>[a(S,{xs:24,sm:8,md:6},{default:l(()=>[a(N,{class:"navigation-card"},{default:l(()=>[a(R,{"default-active":y.value,class:"management-menu",onSelect:V},{default:l(()=>[a(x,{index:"profile"},{default:l(()=>[a(r,null,{default:l(()=>[a(w(ee))]),_:1}),e[11]||(e[11]=t("span",null,"个人信息",-1))]),_:1}),a(x,{index:"minecraft"},{default:l(()=>[a(r,null,{default:l(()=>[a(w(ae))]),_:1}),e[12]||(e[12]=t("span",null,"Minecraft 绑定",-1))]),_:1}),a(x,{index:"security"},{default:l(()=>[a(r,null,{default:l(()=>[a(w(le))]),_:1}),e[13]||(e[13]=t("span",null,"账户安全",-1))]),_:1}),a(x,{index:"preferences"},{default:l(()=>[a(r,null,{default:l(()=>[a(w(te))]),_:1}),e[14]||(e[14]=t("span",null,"偏好设置",-1))]),_:1})]),_:1},8,["default-active"])]),_:1})]),_:1}),a(S,{xs:24,sm:16,md:18},{default:l(()=>[a(N,{class:"content-card"},{default:l(()=>[y.value==="profile"?(_(),k("div",ve,[e[19]||(e[19]=t("h2",null,"个人信息",-1)),a($,{ref_key:"profileFormRef",ref:A,model:s,rules:v,"label-width":"120px"},{default:l(()=>[a(m,{label:"用户ID"},{default:l(()=>[a(c,{modelValue:w(f).user.userId,"onUpdate:modelValue":e[0]||(e[0]=o=>w(f).user.userId=o),disabled:""},null,8,["modelValue"])]),_:1}),a(m,{label:"用户名",prop:"username"},{default:l(()=>[a(c,{modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=o=>s.username=o)},null,8,["modelValue"])]),_:1}),a(m,{label:"邮箱",prop:"email"},{default:l(()=>[a(c,{modelValue:s.email,"onUpdate:modelValue":e[2]||(e[2]=o=>s.email=o)},null,8,["modelValue"]),w(f).user.qqVerified?(_(),G(C,{key:0,type:"success",style:{"margin-left":"10px"}},{default:l(()=>[...e[15]||(e[15]=[g(" 已验证 ",-1)])]),_:1})):(_(),G(C,{key:1,type:"warning",style:{"margin-left":"10px"}},{default:l(()=>[...e[16]||(e[16]=[g(" 未验证 ",-1)])]),_:1}))]),_:1}),a(m,{label:"QQ号"},{default:l(()=>[a(c,{modelValue:s.qqNumber,"onUpdate:modelValue":e[3]||(e[3]=o=>s.qqNumber=o),placeholder:"请输入QQ号"},null,8,["modelValue"])]),_:1}),a(m,{label:"头像"},{default:l(()=>[a(me,{modelValue:s.avatarUrl,"onUpdate:modelValue":e[4]||(e[4]=o=>s.avatarUrl=o),onUploaded:B},null,8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(p,{type:"primary",loading:w(F).loading,onClick:U},{default:l(()=>[...e[17]||(e[17]=[g(" 保存修改 ",-1)])]),_:1},8,["loading"]),a(p,{onClick:P},{default:l(()=>[...e[18]||(e[18]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):y.value==="minecraft"?(_(),k("div",ce,[e[20]||(e[20]=t("h2",null,"Minecraft 账户绑定",-1)),a(ne)])):y.value==="security"?(_(),k("div",ge,[e[27]||(e[27]=t("h2",null,"账户安全",-1)),t("div",we,[t("div",ye,[e[22]||(e[22]=t("div",{class:"security-info"},[t("h3",null,"密码"),t("p",null,"定期更改密码以保护账户安全")],-1)),a(p,{type:"primary",text:"",onClick:e[5]||(e[5]=o=>b.value=!0)},{default:l(()=>[...e[21]||(e[21]=[g(" 更改密码 ",-1)])]),_:1})]),t("div",Ue,[e[24]||(e[24]=t("div",{class:"security-info"},[t("h3",null,"登录设备"),t("p",null,"管理您的登录设备和会话")],-1)),a(p,{type:"primary",text:""},{default:l(()=>[...e[23]||(e[23]=[g("查看",-1)])]),_:1})]),t("div",be,[e[26]||(e[26]=t("div",{class:"security-info"},[t("h3",null,"两步验证"),t("p",null,"为账户添加额外的安全层")],-1)),a(p,{type:"primary",text:""},{default:l(()=>[...e[25]||(e[25]=[g("启用",-1)])]),_:1})])])])):y.value==="preferences"?(_(),k("div",Ve,[...e[28]||(e[28]=[t("h2",null,"偏好设置",-1),t("p",null,"功能开发中...",-1)])])):J("",!0)]),_:1})]),_:1})]),_:1})])]),a(W,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value=o),title:"修改密码",width:"400px"},{footer:l(()=>[a(p,{onClick:e[9]||(e[9]=o=>b.value=!1)},{default:l(()=>[...e[30]||(e[30]=[g("取消",-1)])]),_:1}),a(p,{type:"primary",loading:M.value,onClick:K},{default:l(()=>[...e[31]||(e[31]=[g(" 确认修改 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a($,{ref_key:"passwordFormRef",ref:E,model:u,rules:d,"label-width":"100px"},{default:l(()=>[a(m,{label:"当前密码",prop:"currentPassword"},{default:l(()=>[a(c,{modelValue:u.currentPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>u.currentPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(m,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(c,{modelValue:u.newPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>u.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(m,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(c,{modelValue:u.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=o=>u.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ke=D(Pe,[["__scopeId","data-v-dd1a6d07"]]);export{ke as default};
